<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>TeleController</title>
	    <link rel="shortcut icon" href="favicon.ico">
		<script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
		<script src="{{ url_for('static', filename='js/jquery.mobile-1.4.5.min.js') }}"></script>
	    <style>
			.center-wrapper{
				position:absolute;
			  text-align: center;
			}
			.center-wrapper * {
			  margin: 0 auto;
			  padding:0.75em;
			}
			.center-wrapper-inline * {
			  margin: 0 2em;
			}
			
			#right-wrapper{
				right:10em;
				bottom:5em;
			}
			#left-wrapper{
				left:10em;
				bottom:10em;
			}
				
			#leftUpDown {
				position:relative;
				width: 50px;
				height: 200px;
				left:-5em;
				bottom:-7.5em;
				padding:0;
				/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#8e8e8e+0,f1f1f1+47,d3d3d3+50,f1f1f1+53,8e8e8e+100 */
				background: #8e8e8e; /* Old browsers */
				background: -moz-linear-gradient(top,  #8e8e8e 0%, #f1f1f1 47%, #d3d3d3 50%, #f1f1f1 53%, #8e8e8e 100%); /* FF3.6-15 */
				background: -webkit-linear-gradient(top,  #8e8e8e 0%,#f1f1f1 47%,#d3d3d3 50%,#f1f1f1 53%,#8e8e8e 100%); /* Chrome10-25,Safari5.1-6 */
				background: linear-gradient(to bottom,  #8e8e8e 0%,#f1f1f1 47%,#d3d3d3 50%,#f1f1f1 53%,#8e8e8e 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
				filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#8e8e8e', endColorstr='#8e8e8e',GradientType=0 ); /* IE6-9 */

			}
			#leftLeftRight {
				position:relative;
				width: 200px;
				height: 50px;
				left:3em;
				padding:0;
				background: #8e8e8e; /* Old browsers */
				background: -moz-linear-gradient(left,  #8e8e8e 0%, #f1f1f1 47%, #d3d3d3 50%, #f1f1f1 53%, #8e8e8e 100%); /* FF3.6-15 */
				background: -webkit-linear-gradient(left,  #8e8e8e 0%,#f1f1f1 47%,#d3d3d3 50%,#f1f1f1 53%,#8e8e8e 100%); /* Chrome10-25,Safari5.1-6 */
				background: linear-gradient(to right,  #8e8e8e 0%,#f1f1f1 47%,#d3d3d3 50%,#f1f1f1 53%,#8e8e8e 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
				filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#8e8e8e', endColorstr='#8e8e8e',GradientType=1 ); /* IE6-9 */

			}
			
			#rightStick {
				width: 200px;
				height: 200px;
				padding:0;
				-webkit-border-radius: 150px;
				-moz-border-radius: 150px;
				border-radius: 150px;
				/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#8e8e8e+0,f1f1f1+47,d3d3d3+50,f1f1f1+53,8e8e8e+100 */
				background: #8e8e8e; /* Old browsers */
				background: -moz-radial-gradient(center, ellipse cover,  #8e8e8e 0%, #f1f1f1 47%, #d3d3d3 50%, #f1f1f1 53%, #8e8e8e 100%); /* FF3.6-15 */
				background: -webkit-radial-gradient(center, ellipse cover,  #8e8e8e 0%,#f1f1f1 47%,#d3d3d3 50%,#f1f1f1 53%,#8e8e8e 100%); /* Chrome10-25,Safari5.1-6 */
				background: radial-gradient(ellipse at center,  #8e8e8e 0%,#f1f1f1 47%,#d3d3d3 50%,#f1f1f1 53%,#8e8e8e 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
				filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#8e8e8e', endColorstr='#8e8e8e',GradientType=1 ); /* IE6-9 fallback on horizontal gradient */

			}
			
			
			
			#mainBackground{
				max-width:100%;
				min-height:100%;
				max-height:100%;
				
				position:absolute;
				
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
			}
			
	    </style>
	</head>
	<body>
	<div data-role="page" class="jqm-demos" data-quicklinks="true">
		<img id="mainBackground" src = "{{ url_for('video_feed') }}"></img>
	    <div role="main" class="ui-content jqm-content">

				<div class="center-wrapper" id="right-wrapper">
				  <div class="controller" id="rightStick"></div>
				</div>
				
				<div class="center-wrapper" id="left-wrapper">
				  <div class="controller" id="leftUpDown"></div>
				  <div class="controller" id="leftLeftRight"></div>
				</div>
			
		</div>
	</div><!-- /panel -->
	<script>
		var mouseIsDown = false;
		var nInterval;
		var hostName = "192.168.0.104"
		var socketController = new WebSocket("ws://"+hostName+":9001");
		var currentController;
		
		var mouseLocation;
	
		$(function(){
		
			document.oncontextmenu = function() {return false;};

			$(document).mousedown(function(e){

				if ( e.button == 2 )
				{ 
					//alert('Right mouse button!'); 
					return false; 
				}

				return true;
			});
			
			$( '.controller' ).mousedown(function(e){
			
				mouseLocation = e;
				currentController = this;
				mouseIsDown = true;
				
				controllerUsed();
				nInterval = setInterval(function(){
					controllerUsed();
				},50);
				
				return false;
			});
			$( '.controller' ).mousemove(function(e){
				mouseLocation = e;
			});
			$( 'body' ).mouseup(function(){
				if(mouseIsDown){
					controllerReleased();
				}
				return false;
			});
			
		});
		
		function controllerUsed(){			
			var offset = $(currentController).offset();
			var width = $(currentController).width();
			var height = $(currentController).height();
			var x = mouseLocation.pageX - (offset.left+(width/2));
			var y = mouseLocation.pageY - (offset.top+(height/2));
			
			//console.log("Click: " + x/100 + " " + y/100);
			var controlName = $(currentController).attr('id');
			//console.log(controlName);
			
			var result = controlName+","+x/100+","+y/100;
			socketController.send(result);
		}
		function controllerReleased(){
			socketController.send("None"+","+0+","+0);
			mouseIsDown = false;
			clearInterval(nInterval);
		}
		
	</script>
</body>
</html>
